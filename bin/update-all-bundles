#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd $DIR

COUNTER=0
LIST=""
for BUNDLE_DIR in $(ls);
do
    if [[ -d "$DIR/$BUNDLE_DIR/.git" ]]; then
        cd $DIR/$BUNDLE_DIR
        # git reset --hard origin/master
        GIT_OUTPUT=$(git pull origin master 2>&1)
        COUNT=$(echo $GIT_OUTPUT | grep "Updating" | wc -l)
        # echo "Git:" $GIT_OUTPUT
        # echo "Grep:" $(echo $GIT_OUTPUT | grep "Updating")
        # echo "Counter:" $COUNT / $COUNTER
        if [[ $COUNT > 0 ]]; then
            echo " * $BUNDLE_DIR ... updated"
            LIST="$LIST\n$BUNDLE_DIR"
            COUNTER=$(( $COUNTER + $COUNT ))
        fi
    fi
done

notify-send "VIM update" "$COUNTER bundles were updated. $LIST"
